# PostgreSQL 17-Alpine
name: PostgreSQL Service

on:
  workflow_call:
    outputs:
      postgres-ready:
        description: 'PostgreSQL service readiness status'
        value: ${{ jobs.postgres-service.outputs.postgres-ready }}

permissions:
  contents: read

jobs:
  postgres-service:
    name: PostgreSQL Service
    runs-on: [self-hosted, linux, X64, kubernetes]
    outputs:
      postgres-ready: ${{ steps.wait.outputs.ready }}

    steps:
      - name: Wait for PostgreSQL service
        id: wait
        uses: ./.github/actions/wait-for-service
        with:
          service-type: postgres
          host: localhost
          port: '5432'
          max-retries: '30'

      - name: Verify PostgreSQL connection
        shell: bash
        run: |
          psql postgresql://localhost:5432/testdb -c 'SELECT 1'
